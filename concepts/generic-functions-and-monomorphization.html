<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Generic Functions and Monomorphization - Twiggyüå±</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body class="light">
        <!-- Provide site root to javascript -->
        <script type="text/javascript">var path_to_root = "../";</script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { } 
            if (theme === null || theme === undefined) { theme = 'light'; }
            document.body.className = theme;
            document.querySelector('html').className = theme + ' js';
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <ol class="chapter"><li class="affix"><a href="../index.html">Introduction</a></li><li class="spacer"></li><li><a href="../install.html"><strong aria-hidden="true">1.</strong> üì¶ Install</a></li><li><a href="../concepts/index.html"><strong aria-hidden="true">2.</strong> üí° Concepts</a></li><li><ol class="section"><li><a href="../concepts/call-graph.html"><strong aria-hidden="true">2.1.</strong> Call Graph</a></li><li><a href="../concepts/paths.html"><strong aria-hidden="true">2.2.</strong> Paths</a></li><li><a href="../concepts/dominators-and-retained-size.html"><strong aria-hidden="true">2.3.</strong> Dominators and Retained Size</a></li><li><a href="../concepts/generic-functions-and-monomorphization.html" class="active"><strong aria-hidden="true">2.4.</strong> Generic Functions and Monomorphization</a></li></ol></li><li><a href="../usage/index.html"><strong aria-hidden="true">3.</strong> üèãÔ∏è‚Äç‚ôÄÔ∏è Usage</a></li><li><ol class="section"><li><a href="../usage/command-line-interface/index.html"><strong aria-hidden="true">3.1.</strong> ‚å® Command Line Interface</a></li><li><ol class="section"><li><a href="../usage/command-line-interface/top.html"><strong aria-hidden="true">3.1.1.</strong> twiggy top</a></li><li><a href="../usage/command-line-interface/paths.html"><strong aria-hidden="true">3.1.2.</strong> twiggy paths</a></li><li><a href="../usage/command-line-interface/monos.html"><strong aria-hidden="true">3.1.3.</strong> twiggy monos</a></li><li><a href="../usage/command-line-interface/dominators.html"><strong aria-hidden="true">3.1.4.</strong> twiggy dominators</a></li><li><a href="../usage/command-line-interface/diff.html"><strong aria-hidden="true">3.1.5.</strong> twiggy diff</a></li><li><a href="../usage/command-line-interface/garbage.html"><strong aria-hidden="true">3.1.6.</strong> twiggy garbage</a></li></ol></li><li><a href="../usage/as-a-crate.html"><strong aria-hidden="true">3.2.</strong> ü¶Ä As a Crate</a></li><li><a href="../usage/on-the-web-with-webassembly.html"><strong aria-hidden="true">3.3.</strong> üï∏ On the Web with WebAssembly</a></li></ol></li><li><a href="../supported-binary-formats.html"><strong aria-hidden="true">4.</strong> üîé Supported Binary Formats</a></li><li class="spacer"></li><li><a href="../contributing/index.html"><strong aria-hidden="true">5.</strong> üôå Contributing to Twiggy</a></li><li><ol class="section"><li><a href="../contributing/building.html"><strong aria-hidden="true">5.1.</strong> Building</a></li><li><a href="../contributing/testing.html"><strong aria-hidden="true">5.2.</strong> Testing</a></li><li><a href="../contributing/code-formatting.html"><strong aria-hidden="true">5.3.</strong> Code Formatting</a></li><li><a href="../contributing/pull-requests.html"><strong aria-hidden="true">5.4.</strong> Pull Requests</a></li><li><a href="../contributing/team.html"><strong aria-hidden="true">5.5.</strong> Team</a></li></ol></li></ol>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light <span class="default">(default)</span></button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">Twiggyüå±</h1> 

                        <div class="right-buttons">
                            <a href="../print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <a class="header" href="#generic-functions-and-monomorphization" id="generic-functions-and-monomorphization"><h1>Generic Functions and Monomorphization</h1></a>
<p>Generic functions with type parameters in Rust and template functions in C++ can
lead to code bloat if you aren't careful. Every time you instantiate these
generic functions with a concrete set of types, the compiler will <em>monomorphize</em>
the function, creating a copy of its body replacing its generic placeholders
with the specific operations that apply to the concrete types. This presents
many opportunities for compiler optimizations based on which particular concrete
types each copy of the function is working with, but these copies add up quickly
in terms of code size.</p>
<p>Example of monomorphization in Rust:</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
fn generic_function&lt;T: MyTrait&gt;(t: T) { ... }

// Each of these will generate a new copy of `generic_function`!
generic_function::&lt;MyTraitImpl&gt;(...);
generic_function::&lt;AnotherMyTraitImpl&gt;(...);
generic_function::&lt;MyTraitImplAlso&gt;(...);
#}</code></pre></pre>
<p>Example of monomorphization in C++:</p>
<pre><code class="language-c++">template&lt;typename T&gt;
void generic_function(T t) { ... }

// Each of these will also generate a new copy of `generic_function`!
generic_function&lt;uint32_t&gt;(...);
generic_function&lt;bool&gt;(...);
generic_function&lt;MyClass&gt;(...);
</code></pre>
<p>If you can afford the runtime cost of dynamic dispatch, then changing these
functions to use trait objects in Rust or virtual methods in C++ can likely save
a significant amounts of code size. With dynamic dispatch, the generic
function's body is not copied, and the generic bits within the function become
indirect function calls.</p>
<p>Example of dynamic dispatch in Rust:</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
fn generic_function(t: &amp;MyTrait) { ... }
// or
fn generic_function(t: Box&lt;MyTrait&gt;) { ... }
// etc...

// No more code bloat!
let x = MyTraitImpl::new();
generic_function(&amp;x);
let y = AnotherMyTraitImpl::new();
generic_function(&amp;y);
let z = MyTraitImplAlso::new();
generic_function(&amp;z);
#}</code></pre></pre>
<p>Example of dynamic dispatch in C++:</p>
<pre><code class="language-c++">class GenericBase {
  public:
    virtual void generic_impl() = 0;
};

class MyThing : public GenericBase {
  public
    virtual void generic_impl() override { ... }
};

class AnotherThing : public GenericBase {
  public
    virtual void generic_impl() override { ... }
};

class AlsoThing : public GenericBase {
  public
    virtual void generic_impl() override { ... }
};

void generic(GenericBase&amp; thing) { ... }

// No more code bloat!
MyThing x;
generic(x);
AnotherThing y;
generic(y);
AlsoThing z;
generic(z);
</code></pre>
<p><code>twiggy</code> can analyze a binary to find which generic functions are being
monomorphized repeatedly, and calculate an estimation of how much code size
could be saved by switching from monomorphization to dynamic dispatch.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../concepts/dominators-and-retained-size.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../usage/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="../concepts/dominators-and-retained-size.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="../usage/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
